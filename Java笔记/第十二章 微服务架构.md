# 第十二章 微服务架构

## 12.1 什么是微服务架构？

简而言之，微服务架构是一种将单个应用程序开发为一套小服务程序的方法，每个小服务都在自己的进程中运行，并使用轻量级协议（通常是HTTP协议）进行通信。

这些服务围绕业务功能构建，可以通过全自动部署机制独立部署。这些服务很少使用中心化管理模式，可以用不同的编程语言开发，也可以使用不同的数据存储技术。

现在的微服务架构，基本上认为微服务架构通信的接口都是**Rest API**，以**HTTP+Jason**格式进行交互。相比传统的rpc、dubbo、web service重量级的框架来说，有些业务场景需要更高性能的通信协议，后续会看到一些新版本的微服务框架在不断迭代和进化。

### 12.0.1 微服务架构优点

1）易于替换；

2）独立部署；

3）专注某个任务；

4）高度解耦；

5）基于功能进行组织：商品、支付、评论、机票、新闻、酒店、游戏等；

6）服务可以使用不同的语言、系统、平台；

7）通信使用语言中立的协议；

8）通常是HTTP；

9）独立技术栈；

10）易于测试。

### 12.0.2 微服务架构缺点

1）通信成本上升；

2）集成测试、部署变得复杂；

3）架构复杂；

4）数据一致性；

5）重复工作；

6）性能监控；

7）系统部署依赖。

## 12.5 微服务架构Microservice的经典协议

### 12.5.1 微服务常用的通信模式

**1. 微服务的消息通信模式**

消息交换的模式有很多种，使用较多的是同步消息的交互模式，典型特征是发送完消息后会等待一个结果。浏览器发送一个网页请求后，会等待网页返回，中间存在请求应答的过程，这就是属于同步请求的模式。

异步请求模式的常见场景是消息推送，发送完某个消息后，这个消息并不会立即到达，可能会经过一定延迟才到达接收方。异步模式的优点是并发或吞吐量较高；缺点是无法保障消息的实时性。

**2. 经典的RPC协议**

RPC协议本身是远程过程调用，主要解决远程的通信问题，而不仅是封装数据通信协议与网络协议。

在此基础上，需要借助某些框架语言来实现功能交互。例如，希望客户端通过调用服务器端的某个订单或者加密的功能，实现远程的功能调用。

这是通过网络来暴露自己代码功能较早的一种方式。RPC协议非常多，不仅是REST API，APP协议暴露接口，前端分裂架构基本上也是API加前端、小程序、APP、PC网页等这种模式，是在移动互联网时代用得较多的架构。

**3. 微服务常用的通信协议**

 	1. 微服务之间的通信协议与框架中间件
     - 同步调用
       - HTTP/REST（synchronous）
       - REST（http，websocket，JAX-RX，Spring Boot，node.js，Web API）
       - RPC（Netty，Dubbo，Thrift，gRPC）
     - 异步调用
       - AMQP（asynchronous）
       - 消息队列（ActiveMQ，RabbitMQ，Kafka，RocketMQ，Notify，MetaQ）

## 12.6 微服务框架

1. Spring Cloud
2. Dubbo
3. Spring Cloud Alibaba
4. SOFA
5. Go Micro
6. Seneca Microservice
7. KumuluzEE
8. Enduro/X

![image-20210512144120564](C:\Users\MacroYuan\AppData\Roaming\Typora\typora-user-images\image-20210512144120564.png)

## 12.7 微服务架构Microservice的设计策略

### 12.7.1微服务的设计原则

- 需求第一：
- 单一职责：
- 协议统一：
- 独立开发：
- 独立部署：

### 12.7.2 微服务的拆分原则

### 12.7.3 微服务设计的关注点

### 12.7.4 微服务设计的五大考量

- 微服务拆分
- 微服务高可用
- 微数据安全
- 微服务数据同步
- 微服务监控

## 12.9 微服务架构Microservice典型场景

1. 电商网站微服务架构设计案例
2. 新浪微博微服务架构设计案例
3. 微信聊天微服务架构设计案例
4. 支付系统微服务架构设计案例
5. 地图导航微服务架构设计案例
6. 手机游戏微服务架构设计案例
7. 物联网IOT微服务架构设计案例
8. 广告数据微服务架构设计案例