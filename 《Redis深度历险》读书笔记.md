**Redis分布式锁的问题？**

> set和setnx的问题

setnx指令获取到锁，expire指令给锁设置一个过期时间，当获取到锁后经过这么多的时间会自动释放锁。当然这样也存在一个问题，expire指令必须要在setnx指令获取到锁后才能执行，如果expire指令出错，释放锁的指令也没有正常执行，那么这个锁仍然被占用不能被释放。

Redis2.8版本中推出了set指令，可同时进行加锁和设计过期时间的原子操作。